{% extends 'base.html' %}

{% set page_title = 'Les clubs' %}

{% block content %}

<div class="container" id="clubs">

	<h2>Rejoindre un club</h2>
	<div class="alert alert-info">
		<h4>Aide</h4>
		Vous pouvez rejoindre un club, en cliquant sur "Rejoindre".<br />
		Chaque demande est alors validée (ou non) par le gérant du club.
	</div>

  <div class="row">
    {% for club in clubs %}
    <div class="col-sm-6 col-xs-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          {{club.name}}
          {% if club.private %}
            <span class="pull-right label label-danger">Club privé</span>
          {% endif %}
        </div>
        <div class="panel-body">
          <div class="row">
            <div class="col-sm-6 col-xs-12">
              <address>
                {{club.address}}<br />
                <strong>{{ club.zipcode }} {{ club.city }}</strong>
              </address>
              <p>
                <span class="label label-info">Gérant</span> {{ club.manager.first_name }} {{ club.manager.last_name }}
              </p>
            </div>
            <div class="col-sm-6 col-xs-12">
            {% if user.is_authenticated() %}
              {% if club.has_user(request.user) %}
                {% with club.clubmembership_set.get(user=request.user) as member %}
                  {% if member.role == 'archive' %}
                  <span class="btn disabled btn-danger pull-right">Refusé</span>
                  {% elif member.role == 'prospect' %}
                  <span class="btn disabled btn-info pull-right">Attente de validation</span>
                  {% else %}
                  <span class="btn disabled btn-success pull-right">Membre</span>
                  {% endif %}

                  {# View members when user is in club #}
                  <a href="{% url club-members club.slug %}" class="btn btn-primary pull-right"><i class="icon-club"></i> Voir les membres</a>

                {% endwith %}
              {% else %}
                <a href="{% url club-join club.slug %}" class="btn btn-success modal-action pull-right"><i class="icon-plus"></i> Rejoindre</a>


                {# View members when club is public and user is connected #}
                {% if not club.private %}
                <a href="{% url club-members club.slug %}" class="btn btn-primary pull-right"><i class="icon-club"></i> Voir les membres</a>
                {% endif %}
              {% endif %}

            {% else %}

              <p class="text-info text-right">Pour rejoindre ce club, <a href="{% url login %}">connectez vous</a> ou <a href="{% url user-create %}">créez un compte</a></p>

              {# View members when club is public and user is not connected #}
              {% if not club.private %}
              <a href="{% url club-members club.slug %}" class="btn btn-primary pull-right"><i class="icon-club"></i> Voir les membres</a>
              {% endif %}
            {% endif %}

            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

</div>

{% endblock %}
