{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h1>{% if messages %}{{ messages.count() }} {% endif %}Messages reçus</h1>
  {% if messages %}
    {% for message in messages %}
    <div class="row message">
      <div class="col-sm-1 col-xs-2">
        <img class="img-responsive img-rounded" src="{{message.writer.avatar.url}}" alt="Avatar {{message.writer.username}}" />
      </div>
      <div class="col-sm-3 col-xs-7">
        <a href="{% url user-public-profile message.writer.username %}">
          {{ message.writer.first_name }} {{ message.writer.last_name }}
        </a>
        <br />
        Il y a {{ message.created|timesince() }}
      </div>
      <div class="visible-xs col-xs-3">
        {% if message.session %}
        <a href="{% url message-session-add message.session.pk %}" class="modal-action btn btn-primary">Répondre</a>
        {% else %}
        <a href="{% url message-user-add message.writer.username %}" class="modal-action btn btn-primary">Répondre</a>
        {% endif %}
      </div>
      <div class="col-sm-6 col-xs-12">
        <div class="well">
          {{message.message|linebreaks()}}
        </div>
        {% if message.session %}
        <p>
          <i class="icon-comment"></i>
          Sur votre séance <i class="icon-sport-{{message.session.sport.slug}}"></i>
          {% with message.session.day.date as dt %}
          <a href="{% url report-day dt.year, dt.month, dt.day %}">
            {{ message.session.name }}
          </a>
          du {{ dt|date('l d E Y') }}
          {% endwith %}
        </p>
        {% else %}
        <i class="icon-mail"></i> Message privé
        {% endif %}
      </div>
      <div class="col-sm-2 hidden-xs">
        {% if message.session %}
        <a href="{% url message-session-add message.session.pk %}" class="modal-action btn btn-primary">Répondre</a>
        {% else %}
        <a href="{% url message-user-add message.writer.username %}" class="modal-action btn btn-primary">Répondre</a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  {% else %}
  <div class="alert alert-info">
    <h4>Pas de messages</h4>
    Vous n'avez pas reçu de messages.
  </div>
  {% endif %}
</div>
{% endblock %}
