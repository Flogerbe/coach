{% extends 'base.html' %}

{% set page_title = 'Mes Records' %}

{% block style %}
<style>
h2, h3 {
	padding-left: 5px;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
	<h2>
    Mes records
    <a href="{% url session-add-type 'race' %}" class="modal-action btn btn-primary pull-right"><span class="icon icon-plus"></span> Ajouter un record</a>
  </h2>

	{% if races %}
	
	{% for category in categories %}
	<h3>{{category.name}}</h3>

	<div class="row-striped">
		{% for race in races[category.id] %}
		<div class="row {% if loop.first %}race-record{% endif %}">
			<div class="col-sm-4"><strong>{{ race.name }}</strong></div>
			<div class="col-sm-3">{{ race.date|date('d E Y')}}</div>

      {% with race.sessions.filter(sport__depth=1) as sessions %}
      <div class="col-sm-2">
      <p><strong>{{ race.distance_total|floatformat(2)}} km</strong></p>

      {% if sessions.count() > 1 %}
      {% for session in sessions %}
      <p>
        <i class="icon-sport-{{ session.sport.slug }}" title="{{ session.sport.name }}"></i>
        {{ session.distance|default(0)|floatformat(2) }} km
      </p>
      {% endfor %}
      {% endif %}
      </div>

      <div class="col-sm-2">
      <p><strong>{{ race.time_total|total_time()}}</strong></p>
      {% if sessions.count() > 1 %}
      {% for session in sessions %}
      <p>
        {{ session.time }}
      </p>
      {% endfor %}
      {% endif %}
      </div>
      {% endwith %}
			<div class="col-sm-1">
				<a class="modal-action btn btn-xs {% if loop.first %}btn-warning{% else %}btn-default{% endif %}" href="{% url report-day race.date.year, race.date.month, race.date.day %}">Voir</a>
			</div>
		</div>
		{% endfor %}
	</div>
	{% endfor %}

		{% else %}
		<p class="alert alert-warning">Aucune course renseignée</p>
		{% endif %}

		<h2>Mes courses futures</h2>
		{% if future_races %}
		<div class="row-striped">
			{% for race in future_races %}
			<div class="row">
				<div class="col-sm-4">
					<strong>Dans {{race.date|timeuntil()}}</strong>
				</div>
				<div class="col-sm-7">
					<a class="modal-action" href="{% url report-day race.date.year, race.date.month, race.date.day %}">{{ race.name }}</a>
				</div>
				<div class="col-sm-1">
					<span class="label label-default">{{ race.race_category.name}}</span>
				</div>
			</div>
			{% endfor %}
		</div>
		{% else %}
		<p class="alert alert-warning">Aucune future course renseignée</p>
		{% endif %}

	</div>
	{% endblock %}
