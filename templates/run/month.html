{% extends 'base.html' %}

{% set page_title = 'Calendrier %s' % (months.1|date('E Y'), ) %}

{% block content %}

<style scoped>
table.table {
	table-layout: fixed;
}
</style>

<div class="container">

<h2>
  {% if member %}{{ member.first_name|lower|title }} {{ member.last_name|lower|title }} : {% endif %}{{months.1|date('E Y')}}

  <p class="pull-right">
    {% if not member %}
    <a class="btn btn-default" href="{% url export-month months.1.year, months.1.month %}"><i class="icon-chevron-down"></i> Export CSV</a>
    {% endif %}
    <a class="btn btn-info" href="{{pageyear|url(*pageargs + [months.1.year ])}}"><i class="icon-white icon-list-alt"></i> Calendrier annuel</a>
  </p>
</h2>

<table class="table table-bordered table-condensed calendar hidden-xs">
  <tr>
    <th>Lundi</th>
    <th>Mardi</th>
    <th>Mercredi</th>
    <th>Jeudi</th>
    <th>Vendredi</th>
    <th>Samedi</th>
    <th>Dimanche</th>
  </tr>
{% for week in weeks %}
  <tr>
  {% for day in week %}
  {% with sessions[day] as session %}
    <td class="day modal-action {% if session %}session {{ session.type }}{% else %}empty{% endif %}" href="{{pageday|url(*pageargs + [day.year, day.month, day.day])}}">

    <p class="date">
      {% if day.day == 1 or (loop.first and day.month != months.1.month) %}
      {{day|date('d E')}}
      {% else %}
      {{day|date('d')}}
      {% endif %}
    </p>
    {% if session %}
    <p>
      {{session.name|default('Session sans nom')}}
      {% if session.garmin_activity %}<i class="icon-map-marker"></i>{% endif %}
      {% if session.sport != 'running' %}
      <img class="sport" src="/medias/img/icons/{{ session.sport }}.png" />
      {% endif %}
    </p>
      {% if session.plan_session %}
      <p>
        <i class="icon-tags"> </i> {{ session.plan_session.week.plan.name|truncate(10) }}
      </p>
      {% endif %}
    {% endif %}
  </td>
  {% endwith %}
  {% endfor %}
  </tr>
{% endfor %}
</table>

<div class="visible-xs">
	{% for day in sessions %}
	{% with sessions[day] as session %}
	<div class="modal-action" href="{{pageday|url(*pageargs + [day.year, day.month, day.day])}}">
		<strong>{{day|date('l d E Y')|title()}}</strong>
		<p>{{session.name|default('Session sans nom')}}</p>
        {% if session.plan_session %}
        <p>
          <i class="icon-tags"> </i> {{ session.plan_session.week.plan.name|truncate(10) }}
        </p>
        {% endif %}
	</div>
	{% endwith %}
	{% endfor %}
</div>


<ul class="pager">
  {% if months.0 %}
  <li class="previous">
    <a href="{{pagemonth|url(*pageargs + [months.0.year, months.0.month ])}}">&laquo; {{months.0|date('E Y')}}</a>
  </li>
  {% endif %}
  {% if months.2 %}
  <li class="next">
    <a href="{{pagemonth|url(*pageargs + [months.2.year, months.2.month ])}}">{{months.2|date('E Y')}} &raquo;</a>
  </li>
  {% endif %}
</ul>

</div>

{% endblock %}
