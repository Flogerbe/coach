{% import '_macros.html' as macros %}

{% if form and not report.published %}
<form method="post" action="" class="form-horizontal">
  {% csrf_token %}
  {{ form.management_form|safe }}

  <fieldset>
    <legend>Du {{report.get_date_start()|date('l d E Y')}} au {{report.get_date_end()|date('l d E Y')}}</legend>

    {% for session in form %}
      {% with session.non_field_errors() as err %}
        {{ err|safe }}
      {% endwith %}
      {{ session.id|safe }}
      {% with session.instance.date|date('l d/m')|title as day %}
        {{ macros.input(session.comment, day) }}
      {% endwith %}
    {% endfor %}

    <div class="form-actions">
      <button type="submit" name="action" value="save" class="btn btn-primary">Sauver ces commentaires</button>
      <button type="submit" name="action" value="publish" class="btn btn-success">Envoyer à {{trainer.first_name|default(trainer.username)}}</button>
    </div>
  </fieldset>
</form>
{% else %}

<p class="alert alert-success">
 Ce rapport a bien été envoyé à {{trainer.first_name|default(trainer.username)}}
</p>

<table class="table table-bordered">
  <tr>
    <th>Jour</th>
    <th>Commentaire</th>
  </tr>
  {% for session in sessions %}
  <tr>
    <td>{{session.date|date('l d/m')}}</td>
    <td>{{session.comment|default('')}}</td>
  </tr>
  {% endfor %}
</table>
{% endif %}
