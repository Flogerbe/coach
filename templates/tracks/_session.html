{% if session.track and 'tracks' in privacy %}
{% with session.track as track %}

<div class="col-xs-12">
  <div id="track_{{ track.id }}" class="track_map" data-src="{% url track-coords track.id %}">
    Loading map...
    <a target="_blank" href="{{ track.get_url() }}" class="btn btn-info btn-sm">
      Voir sur {{ track.provider|title() }} <i class="icon-right-open"></i>
    </a>
  </div>
</div>

<div class="panel-group col-xs-12" id="accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#stats_{{track.id}}">
          Statistiques
        </a>
      </h4>
    </div>
    <div id="stats_{{ track.id }}" class="panel-collapse collapse">
      <div class="panel-body">
        {% for stat in track.stats.all() %}
        <div class="col-xs-6 col-sm-1">
          <strong>{{ stat.name }}</strong>
        </div>
        <div class="col-xs-6 col-sm-2 text-right">
          {{ stat.display() | safe }}
        </div>
        {% endfor %}
        Yo stats
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#splits_{{track.id}}">
          Splits
        </a>
      </h4>
    </div>
    <div id="splits_{{track.id}}" class="panel-collapse collapse">
      <div class="panel-body">
        <table class="table table-responsive table-striped table-condensed">
          <tr>
            <th>#</th>
            <th>Distance</th>
            <th>Cumulé</th>
            <th>Temps</th>
            <th>Cumulé</th>
            <th>Vitesse</th>
            <th>Max</th>
            <th>D. +</th>
            <th>D. -</th>
            <th>Energie</th>
          <tr>
          {% for s in track.splits.order_by('position') %}
          <tr>
            <td>{{ s.position }}</td>
            <td>{{ s.distance|default(0)|total_distance() }}</td>
            <td class="text-muted">{{ s.distance_total|default(0)|total_distance() }}</td>
            <td>{{ s.time|default(0)|total_time(short=True) }}</td>
            <td class="text-muted">{{ s.time_total|default(0)|total_time(short=True) }}</td>
            <td>{{ s.speed|default(0)|convert_speed() }} min/km</td>
            <td>{{ s.speed_max|default(0)|convert_speed() }} min/km</td>
            <td>{{ s.elevation_gain|default(0)|floatformat(0) }} m</td>
            <td>{{ s.elevation_loss|default(0)|floatformat(0) }} m</td>
            <td>{{ s.energy|default(0)|floatformat(0) }} kcal</td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  </div>
</div>

{% endwith %}
{% endif %}
